# Session Notes: 2026-01-14

## Completed

### Stability Fixes
- **Code runner timeout**: Implemented real subprocess-based timeout (30s default) instead of in-process `exec()` that could hang indefinitely
- **Interactive code guard**: `run_python` now rejects code containing `input()` with clear error message
- **Provider validation**: Fixed config validation to check correct API key based on selected provider (openai/anthropic/deepseek)
- **Tool-call sequencing**: Fixed LLM error "Messages with role 'tool' must be a response to a preceding message with 'tool_calls'" by adding assistant tool_calls message before tool results
- **Signal handler crash**: Skipped signal registration when running outside main thread (Streamlit uses worker threads)
- **Duplicate import**: Removed duplicate `import time` in agent.py

### UI Improvements
- **Layout**: Removed max-width constraint, sidebar collapsed by default, equal-width columns
- **Streaming display**: Added character-by-character text streaming with cursor animation for thinking, code writing, and final response

### Documentation
- Updated README.md with provider support and stability notes
- Updated ARCHITECTURE.md with reliability and safety sections

### Tests Added
- `tests/test_stability.py`: timeout, provider validation, unsupported tool-calling tests

## Known Issues

1. **Main code disappears when teaching agent replies** - UI state issue causing coder panel to clear

## Files Changed
- `src/tools/code_runner.py`
- `src/config.py`
- `src/agent.py`
- `src/memory.py`
- `src/llm.py`
- `ui/streamlit_app.py`
- `tests/test_stability.py`
- `README.md`
- `ARCHITECTURE.md`
